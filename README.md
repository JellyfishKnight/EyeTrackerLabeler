# PaperTrackerEyeLabeler

**专业的眼部追踪标注工具**

PaperTrackerEyeLabeler 是一个基于 PyQt5 的图像标注工具，专门用于眼部追踪数据集的标注。该工具支持手动标注和 AI 智能检测两种模式，可以高效地完成眼部区域的七边形标注任务。

## 主要功能

- 🎯 **七边形标注**：支持标注前6个六边形顶点 + 1个游离点
- 🤖 **AI 智能检测**：支持 ONNX 模型自动检测标注点
- 📂 **批量处理**：支持文件夹内多张图片的批量标注
- 💾 **自动保存**：支持自动保存标注结果
- ⌨️ **快捷键操作**：提供丰富的键盘快捷键
- 🎨 **可视化界面**：直观的图形界面，支持缩放、拖拽等操作

## 系统要求

- Python 3.7+
- PyQt5 5.15+
- OpenCV 4.5+
- NumPy 1.20+
- ONNX Runtime 1.15+（可选，用于 AI 检测）

## 安装方法

1. **克隆项目**
   ```bash
   git clone <repository-url>
   cd EyeTrackerLabeler
   ```

2. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

3. **运行程序**
   ```bash
   python main.py
   ```

## 使用指南

### 1. 启动配置

首次运行程序时，会出现启动配置对话框：

#### 必选配置
- **图片文件夹**：包含待标注图片的文件夹
- **数据集保存文件夹**：标注数据的保存位置

#### 可选配置
- **模型文件**：ONNX 格式的 AI 检测模型（可选）
- **自动保存**：是否启用自动保存功能

### 2. 支持的图片格式

- JPG / JPEG
- PNG
- BMP
- TIFF / TIF

### 3. 标注说明

#### 七边形标注规则
1. **前6个点**：按顺时针方向标注六边形的6个顶点
2. **第7个点**：标注一个游离的特殊点

#### 标注顺序
- 从六边形最左侧顶点开始
- 按顺时针方向依次标注6个顶点
- 最后标注游离点

#### 颜色说明
- 🟢 **绿色**：六边形顶点
- 🔵 **蓝色**：游离点
- 🔴 **红色**：六边形边框
- 🟡 **黄色**：选中的标签

### 4. 操作方式

#### 键盘快捷键
- `Space` - 添加标签
- `S` - 智能检测（需要模型文件）
- `Q` - 上一张图片
- `E` - 下一张图片

#### 鼠标操作
- **左键点击** - 添加标注点
- **左键拖拽** - 移动标注点
- **右键拖拽** - 拖拽图像
- **鼠标滚轮** - 缩放图像
- **右键双击** - 删除标签

### 5. 界面介绍

#### 左侧面板
- **重新配置**：重新选择文件夹和模型
- **图片导航**：图片列表和滑块导航
- **标注操作**：添加标签、智能检测、保存等操作
- **状态信息**：显示当前配置状态
- **操作说明**：快捷键和鼠标操作说明

#### 中央区域
- **图像显示**：主要的标注工作区域
- **标注可视化**：实时显示标注点和连线

#### 右侧面板
- **标注进度**：显示当前标注进度
- **当前标签**：显示当前图片的所有标签
- **标注说明**：详细的标注规则说明

## 数据保存格式

标注数据保存在 `数据集文件夹/labels/` 目录下，每个图片对应一个同名的 `.txt` 文件。

### 文件格式
- 每行包含一个标注的14个坐标值
- 坐标格式：`x1 y1 x2 y2 x3 y3 x4 y4 x5 y5 x6 y6 x7 y7`
- 所有坐标值均为归一化坐标（0-1范围）

### 示例
```
0.234 0.456 0.345 0.567 0.456 0.678 0.567 0.789 0.678 0.890 0.789 0.123 0.890 0.234
```

## AI 智能检测

### 模型要求
- 格式：ONNX (`.onnx`)
- 输入：RGB 图像
- 输出：7个标注点的坐标

### 使用方法
1. 在启动配置中选择模型文件
2. 点击"智能检测"按钮或按 `S` 键
3. 可使用"全部智能检测"对所有图片进行批量检测

## 常见问题

### Q: 程序启动失败？
A: 请检查 Python 版本和依赖包是否正确安装，确保满足系统要求。

### Q: 图片加载失败？
A: 请确认图片格式是否支持，文件夹路径是否正确。

### Q: 模型加载失败？
A: 请检查模型文件是否为 ONNX 格式，文件是否损坏。

### Q: 标注数据保存在哪里？
A: 标注数据保存在"数据集文件夹/labels/"目录下，每个图片对应一个同名的 .txt 文件。

### Q: 如何修改配置？
A: 点击左侧面板的"重新选择文件夹"按钮，可以重新配置所有设置。

## 版本信息

- **当前版本**：2.0.0
- **开发团队**：PaperTrackerEyeLabeler Team
- **技术支持**：[papertracker-eye.com](http://papertracker-eye.com)

## 许可证

本项目采用开源许可证，详情请参阅 LICENSE 文件。

---

**注意事项**：
1. 请确保有足够的磁盘空间用于保存标注数据
2. 建议在标注重要数据前先备份原始图片
3. 模型文件为可选项，没有模型时仍可进行手动标注
4. 自动保存功能建议保持开启状态，避免意外丢失标注数据